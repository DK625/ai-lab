Việc có **Phase 4 (Decomposition)** là để tạo ra các mảnh ghép, nhưng **Phase 5 (Validation)** là để đảm bảo các mảnh ghép đó có thể ráp lại thành một bức tranh hoàn chỉnh mà không bị lỗi logic.

Nói cách khác: Phase 4 là **"Xây dựng"**, còn Phase 5 là **"Kiểm định chất lượng và sự kết nối"**.

Dưới đây là lý do tại sao Phase 5 là bắt buộc và giải thích chi tiết các công cụ trong đó:

---

### 1. Tại sao cần Phase 5 sau khi đã có Phase 4?

Trong Phase 4, bạn tạo ra hàng chục file `.beads/*.md`. Tuy nhiên, vì làm thủ công hoặc làm rời rạc, bạn rất dễ mắc phải các lỗi hệ thống mà mắt thường khó nhận ra:

* **Quên phụ thuộc:** Task B cần code của Task A, nhưng bạn quên đặt dependency, dẫn đến việc Agent nhảy vào làm Task B trước và bị lỗi.
* **Vòng lặp vô tận (Cycles):** Task A đợi Task B, Task B lại đợi Task A. Kết quả là cả hệ thống đứng im.
* **Nghẽn cổ chai (Bottlenecks):** Quá nhiều Task cùng đợi một Task duy nhất, làm chậm tiến độ toàn bộ dự án.

---

### 2. Giải thích các công cụ trong Phase 5

#### Bước 1: Chạy `bv` (Bead Validator) Analysis

Đây là công cụ tự động để quét toàn bộ thư mục `.beads/` và tìm lỗi logic:

* **`--robot-suggest`**: Tìm những "mối liên hệ bị bỏ lỡ". Nó gợi ý các dependency dựa trên File Scope mà bạn đã khai báo ở Phase 4.
* **`--robot-insights`**: Phát hiện các vòng lặp (Cycles) hoặc các Task quá lớn gây nghẽn tiến độ.
* **`--robot-priority`**: Đảm bảo các Task quan trọng hoặc các Task "chặn" nhiều Task khác được ưu tiên làm trước.

#### Bước 2: Fix Issues (Sửa lỗi)

Dựa trên báo cáo từ `bv`, bạn sử dụng các lệnh này để điều chỉnh lại cấu trúc:

* **`bd dep add`**: Kết nối các Task lại với nhau theo đúng thứ tự logic.
* **`bd dep remove`**: Phá vỡ các vòng lặp phụ thuộc sai lầm.
* **`bd update --priority`**: Sắp xếp lại thứ tự ưu tiên để tối ưu hóa việc chạy song song ở Phase 6.

#### Bước 3: Oracle Final Review

Đây là bước "kiểm tra cuối cùng" bằng AI (Oracle) để đảm bảo tính con người và sự rõ ràng:

* **Tính đầy đủ:** Có task nào bị thiếu không?
* **Sự rõ ràng:** Mô tả trong các Bead có đủ dễ hiểu để một Agent khác đọc vào là làm được ngay không?
* **Logic tổng thể:** Kế hoạch này có thực sự giải quyết được yêu cầu ban đầu của tính năng không?

---

### 3. Ví dụ minh họa

Hãy tưởng tượng bạn đang xây một ngôi nhà:

* **Phase 4 (Decomposition):** Bạn liệt kê danh sách các việc: Xây tường, Lợp mái, Lắp cửa, Sơn nhà.
* **Phase 5 (Validation):** Công cụ `bv` sẽ báo lỗi: "Bạn chưa đặt Task 'Xây tường' làm tiền đề cho 'Lợp mái'. Nếu thợ lợp mái đến trước thợ xây tường thì sẽ không có chỗ để lợp".

> **Kết luận:** Phase 5 giúp bạn có một **Dependency Graph (Đồ thị phụ thuộc)** chuẩn xác. Đây là đầu vào cực kỳ quan trọng để Phase 6 có thể phân chia công việc cho nhiều Agent chạy song song mà không bị xung đột.