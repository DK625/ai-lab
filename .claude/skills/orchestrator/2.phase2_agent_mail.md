## 1. Giải thích Phase 2: Initialize Agent Mail

Phase này là bước thiết lập "hệ thần kinh" giao tiếp cho dự án. Nếu không có bước này, các công cụ khác như gửi tin nhắn sẽ thất bại với lỗi "sender_name not registered".

### Khởi tạo dự án: `ensure_project`
***Chức năng:** Tạo hoặc xác nhận sự tồn tại của một dự án trong hệ thống Mail một cách an toàn (idempotent).
***Tham số `human_key`:** Đây phải là **đường dẫn tuyệt đối** đến thư mục dự án. Việc này giúp tạo ra một định danh dự án ổn định và chống xung đột giữa các môi trường làm việc khác nhau.

### Đăng ký danh tính: `register_agent`

* 
**Chức năng:** Thiết lập "căn cước" cho Agent điều phối (Orchestrator) trong dự án đó.
* 
**Tên Agent (`name`):** Tài liệu khuyến nghị sử dụng định dạng `Tính từ + Danh từ` (ví dụ: **BlueLake**, **GreenCastle**) để dễ nhớ và tránh nhầm lẫn trong nhật ký.
* 
**Vai trò:** Nó lưu trữ hồ sơ về chương trình, mô hình AI và mô tả nhiệm vụ (ví dụ: "Orchestrator cho Epic bd-123") để các Agent khác biết ai đang điều phối.

---

## 2. Cách thực hiện trong Claude

Để Claude có thể sử dụng các lệnh này, bạn cần tích hợp MCP Server thông qua tệp cấu hình của Claude Desktop.
1. **Cài đặt server:** Sử dụng trình cài đặt một dòng hoặc `uv` để thiết lập môi trường Python 3.14.
2. **Kết nối Claude:** Thêm cấu hình vào `claude_desktop_config.json` để Claude nhận diện được các công cụ của `agent-mail`.
3. **Kích hoạt:** Khi bạn bắt đầu một phiên làm việc, chỉ cần ra lệnh: *"Initialize Agent Mail for this project at [đường dẫn tuyệt đối] and register me as BlueLake"*. Claude sẽ tự động gọi các công cụ tương ứng.
---

## 3. Đánh giá: Có cần dán văn bản mẫu (Blurb) vào CLAUDE.md?

Đây là một câu hỏi rất hay về việc tối ưu hóa Context Window (cửa sổ ngữ cảnh).

### Phân tích sự khác biệt

* **Orchestrator Skill:** Cung cấp "quy trình" cho Agent cấp cao (là chính Claude) biết cách vận hành cả hệ thống.
* **Ready-Made Blurb trong CLAUDE.md:** Cung cấp "hướng dẫn sử dụng công cụ" cho **tất cả các Agent** (bao gồm cả các Worker sub-agents mà Orchestrator sẽ tạo ra sau này).



### Đánh giá của tôi

| Khía cạnh | Sử dụng Blurb trong CLAUDE.md | Chỉ dùng Orchestrator Skill |
| --- | --- | --- |
| **Tiết kiệm Context** | Tốn context vì luôn hiện diện trong mọi turn chat. | Tiết kiệm hơn, chỉ load khi cần. |
| **Độ tin cậy** | <br>**Cao.** Các Worker sub-agents khi được tạo ra sẽ biết ngay các quy tắc (như phải reserve file trước khi sửa).

 | <br>**Thấp.** Workers có thể "quên" quy tắc Mail nếu không được nhắc nhở cụ thể trong Prompt.

 |
| **Tính nhất quán** | Đảm bảo mọi Agent đều tuân thủ cùng một chuẩn giao tiếp.

 | Có thể gây ra tình trạng "hallucination" về cách dùng tool của các Worker. |

**Kết luận:**
Bạn **vẫn nên** đưa một phiên bản rút gọn của Blurb vào `CLAUDE.md` hoặc ít nhất là đảm bảo các quy tắc này nằm trong **Worker Prompt Template** của Orchestrator.

Việc khởi tạo (Phase 2) có thể thực hiện sau, nhưng **các quy tắc chơi** (như: "Phải dùng `file_reservation_paths` trước khi sửa code") cần phải được "nạp" vào đầu các Worker ngay từ khi chúng được sinh ra để tránh việc chúng ghi đè code của nhau hoặc bỏ lỡ các tin nhắn quan trọng.

---
Để init khi cần, bạn nên sử dụng macro_start_session hoặc cài đặt các script tích hợp để tận dụng hook SessionStart giúp tự động hóa quy trình khởi tạo ngay khi mở dự án